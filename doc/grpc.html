<!DOCTYPE html>
<html>
  <head>
    <title>gRPC+Protocol Buffers</title>
    <meta charset="utf-8">
    <style>
      @import url(css/yanone.css);
      @import url(css/droid.css);
      @import url(css/ubuntu.css);

      body { font-family: 'Droid Serif'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz';
        font-weight: normal;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono'; }
       /* Two-column layout */
      .left-column {
           width: 50%;
        float: left;
      }
        .left-column h2:last-of-type, .left-column h3:last-child {
          color: #000;
        }
      .right-column {
        width: 40%;
        float: right;
        padding-top: 1em;
      }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# gRPC + Protocol Buffers

---

# Content

### Microservices in Auto
### gRPC
### Protocol Buffers
### Some issues
---

# Microservices in Auto 

### Introduction
#### Microservices architecture (gateway, etc.,)
#### Multi-languages (JS, Python, Go)
#### REST (HTTP/1) as protocol, JSON payload

### Problems
#### JSON payload schema/endpoints design not yet mature
#### Repeative code for HTTP, and JSON parsing

---

# Code in microservice

.left-column[
### Endpoints + Payload
### HTTP REST code + JSON Parsing
### Business logic
]
.right-column[
![code](pic/code_now.svg)
]

---

# Chaos Propagation

.left-column[
### Schema of project changed :(
### Schema of provision changed :(
### Provisioner: WHAT ?
]
.right-column[
![code](pic/propagation.svg)
]

---

# Using framework

### Steep learning curve of framework
###  Follow the ideology of the framework

# Using code generator

### Define your idea with DSL 
### Generate code based on DSL, reducing repetitive code

---

# Introduction of gRPC

**gRPC** (http://www.grpc.io) is Google proposed RPC framework.

- Large-scale distributed microservices system
    - composed with different programming languages
- RPC over HTTP/2.0 (low-latency transport over WWW)
    - Same status codes, headers as HTTP/1.0
    - Just Faster and more gentle

![gRPC](http://www.grpc.io/grpc.github.io/img/landing-2.svg)

---

# Battery included

## Authentication

- SSL/TLS
- token based authenticaton

## Error handling

- Through `error` definition in Protocol Buffers
- Through gRPC `metadata`

## Debugging

- HTTP Trace
- LOG verbosity

---

# Introduction of Protocol Buffers (Proto v3)

### RPC declaration

- Protocol buffers are a way of encoding structured data in an efficient yet extensible format â€“ think SOAP (nightmare), but well designed

### Efficient and compact binary data representation

- Faster deserialization, less CPU/MEM usage, Smaller size binary (Based on various resources)

### Clear compatibility rules, be extended over time
### Generates idiomatic, easy to use classes for many languages
### Strongly typed, less error prone

---

# Proto file

```
syntax = "proto3";

package hello;


service Hello {
	rpc GetInfo(InfoRequest) returns (InfoReply);
}

// placeholder for empty Request body
message InfoRequest {}

message InfoReply {
	string message = 1;
}
```

Same proto file, generates the `javascript`, `python`, `golang` (etc.,) code

---


# Generating the `Garbage` code

.left-column[
### Define your interface with IDL
### Code automatically generated by protoc
### Concentrate only on your business logic
]
.right-column[
![code](pic/code.svg)
]

---

# Simplify the Dev's life


## Defining endpoint/payload with protocol buffers
## Passing around the `protoc` files
## Generating the code
## Concentrating on your own business logic

---

# Some issues

### Under socpe of AUTO

- Protocol Buffers is not readable, only schema (Comparing to JSON)
- RESTful/gRPC gateway only got golang library
- With current scale of Auto, cannot 100% benefit from tech leverage brought by gRPC
- Service adoption (REST -> gRPC), steep workload
- Many dependent services (consul, vault, etc.,) only support the REST API not gRPC

### Under socpe of Ubisoft

- Ubisoft Proxies HTTP/2.0 support in mid 2017
- Not well browser support for the moment
- Client adoption (REST -> gRPC).

---


class: center, middle
# Demo

---

# References

- http://www.slideshare.net/AboutYouGmbH/robert-kubis-grpc-boilerplate-to-highperformance-scalable-apis-codetalks-2015
- https://marutsingh.com


---

    </textarea>
    <script src="js/remark.min.js" type="text/javascript">
    </script>
    <script type="text/javascript">
      var slideshow = remark.create();
    </script>
  </body>
</html>
